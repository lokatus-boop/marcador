<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARCADOR PADEL</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-align: center; background-color: #121212; color: white; margin: 0; padding: 20px; touch-action: manipulation; }
        h1 { margin-bottom: 10px; font-size: 1.5rem; }
        .status { color: #888; font-size: 0.9rem; margin-bottom: 20px; }
        .status.connected { color: #4CAF50; }
        
        button {
            width: 100%;
            padding: 15px;
            margin: 8px 0;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        button:active { transform: scale(0.98); }
        
        .btn-connect { background: #2196F3; color: white; margin-bottom: 20px; }
        .btn-eq1 { background: #2e7d32; color: white; height: 80px; font-size: 1.5rem; }
        .btn-eq2 { background: #c62828; color: white; height: 80px; font-size: 1.5rem; }
        .btn-restar { background: #424242; color: #aaa; font-size: 0.9rem; width: 48%; display: inline-block; }
        
        .config-area { margin-top: 30px; padding-top: 20px; border-top: 1px solid #333; }
        .btn-reset { background: #FF9800; color: black; width: 48%; display: inline-block; margin: 1%;}
        .btn-reset-gold { background: #FFC107; border: 2px solid #FF6F00; color: black; width: 48%; display: inline-block; margin: 1%;}

        .serve-area { margin: 15px 0; display: flex; justify-content: space-between; }
        .btn-serve { background: #333; color: #888; font-size: 0.9rem; width: 48%; border: 1px solid #555; }
        .btn-serve.active { background: #fff; color: #000; border-color: #fff; }

        #controls { display: none; } 
    </style>
</head>
<body>

    <h1>ðŸŽ¾ MARCADOR PADEL</h1>
    <div id="status" class="status">Desconectado</div>

    <button id="btnConnect" class="btn-connect">ðŸ”— CONECTAR MARCADOR</button>

    <div id="controls">
        <div class="serve-area">
            <button id="btnSrv1" class="btn-serve" onclick="setServe(1)">Saca Equipo 1</button>
            <button id="btnSrv2" class="btn-serve" onclick="setServe(2)">Saca Equipo 2</button>
        </div>

        <button class="btn-eq1" onclick="sendCommand('S1')">+ PUNTO EQ 1</button>
        <button class="btn-eq2" onclick="sendCommand('S2')">+ PUNTO EQ 2</button>

        <div style="display:flex; justify-content:space-between">
            <button class="btn-restar" onclick="sendCommand('R1')">- Corregir 1</button>
            <button class="btn-restar" onclick="sendCommand('R2')">- Corregir 2</button>
        </div>

        <div class="config-area">
            <p style="color:#666; margin-bottom:10px">NUEVO PARTIDO</p>
            <button class="btn-reset" onclick="sendCommand('RESET_V'); clearServeUI()">ClÃ¡sico</button>
            <button class="btn-reset-gold" onclick="sendCommand('RESET_O'); clearServeUI()">Punto Oro</button>
        </div>
    </div>

    <script>
        const serviceUuid = "4fafc201-1fb5-459e-8fcc-c5c9c331914b";
        const charUuid = "beb5483e-36e1-4688-b7f5-ea07361b26a8";

        let bluetoothDevice;
        let commandCharacteristic;

        const btnConnect = document.getElementById('btnConnect');
        const statusDiv = document.getElementById('status');
        const controlsDiv = document.getElementById('controls');

        btnConnect.addEventListener('click', async () => {
            try {
                statusDiv.textContent = "Buscando...";
                bluetoothDevice = await navigator.bluetooth.requestDevice({
                    filters: [{ name: 'Marcador Padel' }],
                    optionalServices: [serviceUuid]
                });
                bluetoothDevice.addEventListener('gattserverdisconnected', onDisconnected);
                const server = await bluetoothDevice.gatt.connect();
                const service = await server.getPrimaryService(serviceUuid);
                commandCharacteristic = await service.getCharacteristic(charUuid);

                statusDiv.textContent = "ðŸŸ¢ Conectado";
                statusDiv.classList.add('connected');
                btnConnect.style.display = 'none';
                controlsDiv.style.display = 'block';
            } catch (error) {
                statusDiv.textContent = "Error: " + error.message;
            }
        });

        function onDisconnected() {
            statusDiv.textContent = "ðŸ”´ Desconectado";
            statusDiv.classList.remove('connected');
            btnConnect.style.display = 'block';
            controlsDiv.style.display = 'none';
        }

        async function sendCommand(cmd) {
            if (!commandCharacteristic) return;
            try {
                const encoder = new TextEncoder();
                await commandCharacteristic.writeValue(encoder.encode(cmd));
            } catch (error) { console.error(error); }
        }

        function setServe(team) {
            document.getElementById('btnSrv1').classList.remove('active');
            document.getElementById('btnSrv2').classList.remove('active');
            document.getElementById('btnSrv' + team).classList.add('active');
            sendCommand('SRV' + team);
        }

        function clearServeUI() {
            document.getElementById('btnSrv1').classList.remove('active');
            document.getElementById('btnSrv2').classList.remove('active');
        }
    </script>
</body>
</html>
